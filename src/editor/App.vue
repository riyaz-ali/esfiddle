<template>
  <div class="container-fluid">
    <!-- main header -->
    <Header class="row">
      <div class="col">
        <!-- common tools -->
        <Toolbar :onRun="onRun" :onSave="onSave" :onLint="onLint" :onTidy="onTidy" />

        <!-- User Profile section -->
        <div class="esf user-profile">
          <ul>
            <li v-if="isLoggedIn" class="hint--bottom-left" aria-label="View Profile">
              <a href="/github/myProfile"><i class="fa fa-user"></i></a>
            </li>
            <li v-if="isLoggedIn" class="hint--bottom-left" aria-label="Logout">
              <a href="/github/logout"><i class="fa fa-sign-out"></i></a>
            </li>
            <li v-if="!isLoggedIn" class="hint--bottom-left" aria-label="Login">
              <a href="/auth/github"><i class="fa fa-sign-in"></i></a>
            </li>
          </ul>
        </div>
      </div>
    </Header>
    <div class="esf content row">
      <!-- Side navigation bar -->
      <Navbar class="col-auto" />

      <!-- main content area -->
      <main class="col">
        <div class="row flex-column">
          <!-- IDE -->
          <IDE ref="$ide" class="col" :examples="examples" :lightsOn="true" :changePrivacy="onChangePrivacy" :loadExample="onLoadExample" />
          <!-- Console -->
          <Console ref="$console" class="col-auto" />
        </div>
      </main>
    </div>
  </div>
</template>

<script>
// import base application components
import Header from './components/commons/Header';
import Navbar from './components/commons/Navbar';
import Toolbar from './components/commons/Toolbar';
// main IDE
import IDE from './components/ide';
// application console
import Console from './components/console';

export default {
  components: {
    Header,
    Navbar,
    Toolbar,
    IDE,
    Console
  },

  props: {
    examples: { type: Array, required: true }
  },

  data: function() {
    return {
      isLoggedIn: false
    }
  },

  /** application callback handlers */
  methods: {
    /** Toolbar buttons callback handlers */
    onRun() {
      this.$refs.$console.dispatchCommand('run');
    },
    onSave() {
      this.$refs.$console.dispatchCommand('save');
    },
    onLint() {
      this.$refs.$console.dispatchCommand('lint');
    },
    onTidy() {
      this.$refs.$console.dispatchCommand('tidy');
    },

    /** IDE callback handlers */
    onChangePrivacy(current, callback) {
      callback(!current);
    },
    onLoadExample(index, callback) {
      callback(this.examples[index].code);
    }
  },

  mounted: function() {
    // configure console
    // 1. save command
    this.$refs.$console.addCommand('save', (a, { write, release }) => {
      write('Saving fiddle...');
      this.$api.save(this.$refs.$ide.value()).then(() => {
        write('Fiddle saved!');
      }).catch((reason) => {
        write(reason || 'Cannot save fiddle! Try again later...');
      }).then(release);
    });
  }
};
</script>

<style lang="less">
.container-fluid {
  height: 100%;
}
.esf.content.row {
  height: ~'calc(100% - 48px)';
}
main.col {
  > .row {
    height: 100%;
  }
}

.esf.user-profile {
  height: 100%;
  float: right;

  ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
    
    li {
      display: inline-block;
      margin: 0;
      padding: 0;

      a {
        text-transform: uppercase;
        display: inline-block;
        color: #fff;
        padding-left: 15px; 
        line-height: 3;
        font-size: 14px;
        font-weight: bold;

        &:hover {
          text-decoration: none;
        }
      }
    }
  }
}
</style>
